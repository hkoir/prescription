{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% block content %}



<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-8">
            <div class="card shadow-lg rounded-4 border-0">
                <div class="card-header bg-primary text-white rounded-top-4">
                    <h3 class="mb-0">{% trans "Ai Generated Prescription" %}</h3>
                </div>
                <div class="card-body p-4">
                    <ul class="list-group list-group-flush mb-4">

                        <li class="list-group-item">
                            <strong>{% trans "Prescription Code:" %}</strong> {{ prescription.ai_prescription_code }}
                        </li>
                        <li class="list-group-item">
                            <strong>{% trans "Date:" %}</strong> {{ prescription.created_at|date:"M d, Y H:i" }}
                        </li>
                        <li class="list-group-item">
                            <strong>{% trans "Patient:" %}</strong> {{ prescription.patient }} |
                            <strong>{% trans "Age:" %}</strong> {{ prescription.age }} |
                            <strong>{% trans "Gender:" %}</strong> {{ prescription.gender|capfirst }}
                        </li>
                        <li class="list-group-item">
                            <strong>{% trans "Duration of Symptoms:" %}</strong> {{ normalized_duration }}
                        </li>
                        <li class="list-group-item">
                            <strong>{% trans "Symptoms:" %}</strong><br>
                            {{ prescription.symptoms|linebreaks }}
                        </li>
                    <li class="list-group-item">
                        <strong>{% trans "Summary of Findings:" %}</strong><br>
                        <em>{{ prescription.summary_of_findings|linebreaks }}</em>
                    </li>
                       <li class="list-group-item">
                            <strong>Suggested Medicines:</strong>
                            {% if prescription %}
                            <div class="table-responsive mt-2">
                                <table class="table table-bordered table-striped align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Name</th>
                                            <th>Dosage</th>
                                            <th>Frequency</th>
                                            <th>Duration</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for med in prescription.medicines %}
                                        <tr>
                                            <td>{{ med.name }}</td>
                                            <td>{{ med.dosage }}</td>
                                            <td>{{ med.frequency }}</td>
                                            <td>{{ med.duration }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                                <p class="text-muted">No medicines prescribed.</p>
                            {% endif %}
                        </li>
                    
                        <li class="list-group-item">
                            <strong>Suggested Tests:</strong><br>
                            {{ prescription.tests|linebreaks }}
                        </li>
                        <li class="list-group-item">
                            <strong>Advice:</strong><br>
                            {{ prescription.advice|linebreaks }}
                        </li>
                        <li class="list-group-item">
                            <strong>Recommended Specialist:</strong><br>
			                 {{ prescription.recommended_specialty }}
                        </li>

                        {% if diet_chart and diet_chart != "None" %}
                        <div class="card mt-3">
                            <div class="card-header bg-light">
                            <strong>üçΩÔ∏è Suggested Diet Chart</strong>
                            </div>
                            <div class="card-body">
                            <pre>{{ diet_chart }}</pre>
                            </div>
                        </div>
                        {% endif %}

                        <li class="list-group-item">
                            <strong>Generated By AI:</strong>
                            {% if prescription.created_by_ai %}
                                <span class="badge bg-success">Yes</span>
                                <span class="fw-bold">Want pdf copy?
                                    <a href="{% url 'prescription:ai_prescription_pdf' prescription.id %}"><i class="fas fa-download"></i></a>
                                </span>
                            {% else %}
                                <span class="badge bg-secondary">No</span>
                            {% endif %}
                        </li>
                        {% if prescription.reviewed_by %}
                        <li class="list-group-item">
                            <strong>Reviewed By:</strong> Dr. {{ prescription.reviewed_by.full_name }}
                            {% if prescription.reviewed_on %}
                                <br><strong>Reviewed On:</strong> {{ prescription.reviewed_on|date:"M d, Y H:i" }}
                            {% endif %}
                        </li>
                        {% endif %}

                    </ul> 
                    
                    {% if request.user.role == "patient" %}
                    <div class="alert alert-info text-center mt-4" role="alert">
                        <h5 class="mb-3">Need a physical consultation with a certified doctor?</h5>
                        <div class="d-grid gap-2 d-md-block">
                            <a href="{% url 'prescription:book_doctor' prescription.id %}" class="btn btn-success me-2">
                                Yes, Book Consultation
                            </a>
                            <a href="{% url 'finance:patient_dashboard' %}" class="btn btn-outline-secondary">
                                No, Thanks
                            </a>
                        </div>
                    </div>
                    {% endif %}

                </div>
            </div>
        </div>
    </div>
</div>



{% endblock %}
